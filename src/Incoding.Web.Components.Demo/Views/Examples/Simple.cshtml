@using Incoding.Web.Components.Demo.Controllers
@using Incoding.Web.Components.Grid

@(Html.Components().Grid<SampleData>("grid")
      .Css("bg-white")
      .Mode(GridMode.Stacked)
      .Split(splitting =>

             {
                 splitting.Add(table => table.Columns(cols =>

                                                      {
                                                          cols.Add().Field(s => s.Id).Content(@<text>
                                                                                                   @item.For(s => s.Amount)
                                                                                               </text>
                                                                                             ).Resizable();

                                                          cols.Add().Field(s => s.Amount).Format(ColumnFormat.Percentage)
                                                              .Bind((iml, tmpl) => iml.When(JqueryBind.Change)
                                                                                      .OnBegin(dsl => dsl.Window.Console.Log("m-debug", tmpl.For(s => s.Amount))))
                                                              .Resizable();

                                                          cols.Add().Field(s => s.AmountPercentage).Format(ColumnFormat.Percentage).Resizable();
                                                          cols.Stacked(s => s.Title("Dates"),
                                                                       stacked =>
                                                                       {
                                                                           stacked.Add().Field(s => s.Start).Resizable();
                                                                           stacked.Add().Field(s => s.End).Resizable();
                                                                       });
                                                      }));

                 splitting.Add(table => table.Columns(cols =>
                                                      {
                                                          cols.Spreaded(s => s.Period,
                                                                        5,
                                                                        (builder, i) =>
                                                                        {
                                                                            builder.Stacked(s => s.Title(i.ToString()),
                                                                                            stacked =>
                                                                                            {
                                                                                                stacked.Add().Field(s => s.Hours);
                                                                                                stacked.Add().Field(s => s.JTD).Format(ColumnFormat.Currency);
                                                                                            });
                                                                        });
                                                      }));
             })
      .InfiniteScrolling(scroll =>
                         {
                             scroll.ChunkSize = 10;
                             scroll.LoadingRowsCount = 3;
                         })
      .Empty(await Html.PartialAsync("~/Views/Shared/NoData.cshtml"))
      .DataSource(new DataSource.SignalR
                  {
                          Event = JqueryBind.Load,
                          Method = nameof(SignalHub.StreamData_Many),
                  })
      .Render())
